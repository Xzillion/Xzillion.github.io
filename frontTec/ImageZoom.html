<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>图片放大镜的分析与实现</title>
</head>
<body>
<h1>借助css background-position属性实现图片放大</h1>
<div>
    <img id="solution-1-source" src="http://odqpd0nco.bkt.clouddn.com/blog/images/food2.jpg" style="cursor: zoom-in"/>
    <div id="solution-1-target" style="display: none; background: url('http://odqpd0nco.bkt.clouddn.com/blog/images/food2.jpg') no-repeat;"></div>
</div>
<h1>借助cavans drawImage实现图片的放大</h1>
<div>
    <img id="solution-2-source" src="http://odqpd0nco.bkt.clouddn.com/blog/images/food1.jpg" style=" cursor: zoom-in">
    <canvas id="solution-2-target"></canvas>
</div>
<h1>借助svg viewBox属性实现图片放大</h1>
<div>
    <img id="solution-3-source" src="http://odqpd0nco.bkt.clouddn.com/blog/images/food1.jpg" style="cursor: zoom-in">
    <svg  id="solution-3-target" version="1.0" xmlns:xlink="http://www.w3.org/1999/xlink"  x="0px" y="0px">
        <image xlink:href="http://odqpd0nco.bkt.clouddn.com/blog/images/food1.jpg" x="0px" y="0px"></image>
    </svg>
</div>
</body>
<script>
        const ZOOM_BASE_NUM = 4;//放大倍数
        const POINT_SIZE = 100;//取样点的扩散范围
        /*借助css background-position属性实现图片放大*/
        const SPREAD_SIZE = 400;//放大的范围，以鼠标为中心的像素值
        let solution_1_source = document.getElementById("solution-1-source");//取样容器对象
        let solution_1_target = document.getElementById("solution-1-target");//放大容器对象
        let source_img = new Image();
        source_img.src = solution_1_source.src;//获取大图对象
        source_img.onload = ()=>{
            solution_1_source.style.maxWidth = source_img.width / ZOOM_BASE_NUM + "px";//将大图等比缩小，用于鼠标取样
        }
        solution_1_target.style.width = SPREAD_SIZE + "px";//设置放大器的容器大小，用于显示放大后的取样点
        solution_1_target.style.height = SPREAD_SIZE + "px";
        solution_1_source.addEventListener("mousemove", (event) => {
            solution_1_target.style.display = "inline-block";//显示放大后的取样点
            let event_x = event.offsetX * ZOOM_BASE_NUM;//根据放大倍数将小图坐标映射到大图
            let event_y = event.offsetY * ZOOM_BASE_NUM;
            let position_x = ((event_x - SPREAD_SIZE / 2) > 0) ? ("-" + (event_x - SPREAD_SIZE / 2) + "px") : "0";//获取放大器相对于大图的坐标
            let position_y = ((event_y - SPREAD_SIZE / 2) > 0) ? ("-" + (event_y - SPREAD_SIZE / 2) + "px") : "0";
            solution_1_target.style.backgroundPosition = position_x + " " + position_y;//获取大图的一部分用于放大显示
        })
        /*利用canvas drawImage实现图片的放大*/
        let solution_2_source = document.getElementById("solution-2-source");
        let solution_2_target = document.getElementById("solution-2-target");
        solution_2_target.width = POINT_SIZE * ZOOM_BASE_NUM ;//根据放大倍数和扩散范围配置放大器的大小
        solution_2_target.height = POINT_SIZE * ZOOM_BASE_NUM;
        let canvasCtx = solution_2_target.getContext("2d");//获取canvas画布对象
        solution_2_source.addEventListener("mousemove", (event) => {
            canvasCtx.clearRect(0, 0, POINT_SIZE * ZOOM_BASE_NUM,  POINT_SIZE * ZOOM_BASE_NUM);//清空画布
            let event_x = event.offsetX;
            let event_y = event.offsetY;
            canvasCtx.drawImage(solution_2_source, event_x -  POINT_SIZE/ 2, event_y - POINT_SIZE / 2, POINT_SIZE, POINT_SIZE, 0, 0, POINT_SIZE * ZOOM_BASE_NUM, POINT_SIZE * ZOOM_BASE_NUM);
        })
        /*利用svg viewBox属性实现图片放大*/
        let solution_3_source = document.getElementById("solution-3-source");
        let solution_3_target = document.getElementById("solution-3-target");
        solution_3_target.setAttribute("width", POINT_SIZE * ZOOM_BASE_NUM + "px");//根据放大倍数和扩散范围配置放大器容器大小
        solution_3_target.setAttribute("height", POINT_SIZE * ZOOM_BASE_NUM + "px");
        solution_3_source.onload = ()=>{
            solution_3_target.children[0].setAttribute("width", solution_3_source.width + "px");//原图尺寸和svg内待取样image元素的尺寸必须一致，否则会导致取样点偏移
            solution_3_target.children[0].setAttribute("height", solution_3_source.height + "px");
        }
        solution_3_source.addEventListener("mousemove", (event)=>{
            let event_x = event.offsetX;
            let event_y = event.offsetY;
            solution_3_target.setAttribute("viewBox", "" + (event_x - POINT_SIZE/2) + " " + (event_y - POINT_SIZE/2) + " " +POINT_SIZE + " " +POINT_SIZE);
        })

</script>
</html>